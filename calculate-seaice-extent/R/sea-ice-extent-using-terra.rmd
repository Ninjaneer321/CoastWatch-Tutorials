---
title: "Calculate sea ice extent"
author: "NOAA CoastWatch"
date updated: "8/30/2023"
date created: "7/23/2021"
---

# Calculate sea ice extent

> notebook filename \| sea_ice_extent.Rmd

## Background
The sea ice cover is one of the key components of the polar ecological and climatological research. This measurement has gained attention because of the recent decrease in the Arctic sea ice cover. Satellite observations are a key tool in tracking sea ice cover, providing continuous global coverage extending back to 1978. Typically, sea ice cover is reported as sea ice concentration, which is the percent areal coverage of ice within a grid cell. Depending on the application, additional parameters of interest can be calculated from sea ice cover:  
* __Sea ice area__ - the sum of the product of ice concentration and area of all grid cells with at least 15% ice concentration.  
* __Sea ice extent__ - the sum of the areas of all grid cells with at least 15% ice concentration


## Objective
This tutorial will demonstration how to calculate the sea ice area and extent using sea ice concentration and grid cell area data.  Please visit the  <a href="https://nsidc.org/learn/ask-scientist/what-difference-between-sea-ice-area-and-extent#:~:text=But%20NSIDC%20scientists%2C%20like%20most,the%20total%20in%20their%20entirety.&text=Calculating%20sea%20ice%20extent%20means,with%2015%20percent%20or%20more.">NSIDC website</a> for more detailed descriptions of the calculations. 

## The tutorial demonstrates the following techniques
-   Downloading and saving a netcdf file from PolarWatch ERDDAP data server
-   Accessing satellite data and metadata in polar stereographic projection
-   Downloading and adding grid cell area data to the satellite data
-   Visualizing data on a map
-   Computing sea ice area and extent using sea ice concentration data
-   Plotting a time series of sea ice area and extent


Key R packages and functions used:

-   **terra::rast** - the spatial raster object for the data\

-   **terra::crs** - a function for assigning a projection to a spatial raster object\

-   **terra::cellSize** - the function to calculate grid cell area\

-   **terra::mask** - a function for applying a land mask to the spatial raster object\

-   **terra::ifel** - a function for getting values based on conditions\

## Getting set up

Terra is an R package for geospatial data handling. Terra handles the spatial analysis of projected data. Learn more about terra via the links in the references section at the end of this tutorial.

The current CRAN version of terra (1.3-4) has a bug so we will need to install the development version (1.3-15).

The code in this exercise was tested with terra 1.3-15 and 1.7-38.

`install.packages('terra')`

*Note: Installing terra depends on R 3.5.0 or newer and imports the Rcpp and raster packages.*

```{r Setup}

# Load terra, make sure you have it installed first, see above
library(terra)

# Set up download method as libcurl, this is only needed for Windows machines
options(download.file.method="libcurl", url.method="libcurl")
```

# Get the sea ice data from ERDDAP

Here we download the average monthly sea ice concentration for the Arctic in December 2019. We are using the NSIDC Sea Ice Concentration Climate Data Record (NSIDC ID: G002202). We will download a netCDF file and then load it in as a spatial raster.

```{r download}
data_url <- "https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nhmday.nc?cdr_seaice_conc_monthly[(2022-12-01T00:00:00Z):1:(2022-12-01T00:00:00Z)][(4851137.11):1:(-4850758.92)][(-3850000.0):1:(3750000.0)]"

f <- 'nsidcG02202v4nhmday.nc'
download.file(data_url, destfile=f, mode="wb")
```

# Calculate the cell areas

-   Create spatial object
-   Assign the coordinate reference system. Here we use the EPSG code as decribed in the dataset metadata
-   Calculate the cell areas
-   View the nominal generic resolution  # COMMENT: what does that mean? nominal generic? 

```{r spatial_raster}
ice_rast <- rast(f)
crs(ice_rast) <- "epsg:3413"
res(ice_rast)
```

Calculate the generic cell area, without using the projection info

```{r nominal_area}
nominal_cell_area <- cellSize(ice_rast, mask=F, unit="m", transform=FALSE)
nominal_cell_area
```

Calculate the actual area, using the projection info

```{r true_area}

true_cell_area <- cellSize(ice_rast, mask=F, unit="m", transform=TRUE)
true_cell_area

```

Plot the true cell area in km squared with a land mask

```{r plot_area}
#COMMENT: I would add some explanations here: how do you know what's land? what is this 100000 factor?
masked_area <- mask(true_cell_area, ice_rast) /100000
plot(masked_area)

```

# Calculate the sea ice area

-   The sea ice concentration data is stored in the spatial raster object (ice_rast).
-   The concentration values are represented as ice fraction
-   Sea ice area can be calculated by multiplying the ice fraction values by the calculated cell area
-   Sea ice extent value is defined as 1 for ice fraction equal or greater than 0.15 and 0 otherwise. 
-   So we can simply multiply the ice fraction values by the calculated cell areas to determine the overall ice area.
-   The resulting sea ice area is in square kilometers

```{r}
x <- ice_rast * masked_area
sia <- global(x, "sum", na.rm=TRUE)
sia
```

# Calculate the sea ice extent

-   Similar to the total sea ice calculation, the concentration values represented as ice fraction are used for the extent calculation

-   Sea ice extent defines each grid as either "ice-covered" or "not ice-covered" with a threshold value, typically 15%. In extent calculation, the sea ice concentration fractions first need to be converted to 1 if the fraction value is equal or greater than 0.15 and 0 otherwise. More information about extent can be found from the NSIDC page below

-   Sea ice extent can be calculated by multiplying the extent value of 0 and 1 by the calculated cell area.

-   The resulting sea ice extent is in square kilometers.

```{r}
new_r <- ifel(x > 0.15, 1, 0)
extent <- global(new_r, "sum", na.rm=TRUE)
extent
```

# References

R package Terra: <https://cran.r-project.org/web/packages/terra/>

Terra tutorials, Robert J. Hijmans: <https://rspatial.org/spatial-terra>

Sea Ice Dataset Source and Background Information: NOAA/NSIDC Climate Data Record of Passive Microwave Sea Ice Concentration, Version 4. Data Set ID: G02202. <https://nsidc.org/data/g02202>
