---
title: "Calculate sea ice extent"
author: "NOAA CoastWatch"
date updated: "8/30/2023"
date created: "7/23/2021"
---

# Calculate sea ice extent

> notebook filename \| sea_ice_extent.Rmd

## Background
The sea ice cover is one of the key components of the polar ecological and climatological research. This measurement has gained attention because of the recent decrease in the Arctic sea ice cover. Satellite observations are a key tool in tracking sea ice cover, providing continuous global coverage extending back to 1978. Typically, sea ice cover is reported as sea ice concentration, which is the percent areal coverage of ice within a grid cell. Depending on the application, additional parameters of interest can be calculated from sea ice cover:  
* __Sea ice area__ - the sum of the product of ice concentration and area of all grid cells with at least 15% ice concentration.  
* __Sea ice extent__ - the sum of the areas of all grid cells with at least 15% ice concentration

## Objective
This tutorial will demonstration how to calculate the sea ice area and extent using sea ice concentration and grid cell area data.  Please visit the  <a href="https://nsidc.org/learn/ask-scientist/what-difference-between-sea-ice-area-and-extent#:~:text=But%20NSIDC%20scientists%2C%20like%20most,the%20total%20in%20their%20entirety.&text=Calculating%20sea%20ice%20extent%20means,with%2015%20percent%20or%20more.">NSIDC website</a> for more detailed descriptions of the calculations. 

## The tutorial demonstrates the following techniques
-   Downloading and saving a netcdf file from PolarWatch ERDDAP data server
-   Accessing satellite data and metadata in polar stereographic projection
-   Downloading and adding grid cell area data to the satellite data
-   Visualizing data on a map
-   Computing sea ice area and extent using sea ice concentration data
-   Plotting a time series of sea ice area and extent

## Datasets used

__Sea Ice Concentration, NOAA/NSIDC Climate Data Record V4, Northern Hemisphere__   
The Sea ice concentration (SIC) dataset used in this exercise is produced by NOAA NSIDC from passive microwave sensors at part of the Climate Data Record. It is a science quality dataset of monthly averages the extends from 1978-2022. SIC is reported as the fraction (0 to 1) of each grid cell that is covered by ice. The data are mapped in the Northern Polar Stereographic projection (EPSG:3413). The resolution is 25km, meaning each grid in this data set represents a value that covers a 25km by 25km area. The dataset is available on the <a href="https://polarwatch.noaa.gov/catalog/ice-sq-nh-nsidc-cdr-v4/preview/?dataset=monthly&var=cdr_seaice_conc_monthly&time_min=2022-12-01T00:00:00Z&time_max=2022-12-01T00:00:00Z&proj=epsg3413&colorBar=KT_ice,,,0,1,">PolarWatch data portal</a> and can be  downloaded directly from the PolarWatch ERDDAP at the following link: https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nhmday.graph

__Polar Stereographic Grid Cell Area Values of 25km grid, Polar Stereographic (North), NSIDC Ancillary Data__   
This dataset includes area values (m<sup>2</sup>) of each grid cell in the 25km resolution Northern Polar Stereographic projection. This dataset is available on the <a href="https://polarwatch.noaa.gov/erddap/info/pstere_gridcell_N25k/index.html">PolarWatch ERDDAP</a>



```{r Setup}

# Function to check if pkgs are installed, install missing pkgs, and load
pkgTest <- function(x)
{
  if (!require(x,character.only = TRUE))
  {
    install.packages(x,dep=TRUE,repos='http://cran.us.r-project.org')
    if(!require(x,character.only = TRUE)) stop(x, " :Package not found")
  }
}

list.of.packages <- c( "ggplot2" ,"ncdf4",  "RColorBrewer", "scales")

# create list of installed packages
pkges = installed.packages()[,"Package"]
for (pk in list.of.packages) {
  pkgTest(pk)
}

# Set up download method as libcurl, this is only needed for Windows machines
options(download.file.method="libcurl", url.method="libcurl")
```

# Get the sea ice data from ERDDAP

Here we download the average monthly sea ice concentration for the Arctic from 2021 (January to December). We are using the NSIDC Sea Ice Concentration Climate Data Record (NSIDC ID: G002202). 


__The ERDDAP data request URL for this data subset is presented below.__ 

```
https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nhmday.nc?cdr_seaice_conc_monthly[(2021-01-01T00:00:00Z):1:(2021-12-01T00:00:00Z)][(4843696.04):1:(-4858210.64)][(-3850000.0):1:(3750000.0)]"
```

__The following table shows the component parts of the ERDDAP data request URL.__  


| Name   | Value| Description |
| ---:        |    :----   |          :--- |
| **base_url**    |    https://polarwatch.noaa.gov/erddap/griddap  | ERDDAP URL for gridded datasets
| **datasetID** | nsidcG02202v4nhmday   | Unique ID for dataset from PolarWatch ERDDAP
| **file_type**  | .nc        | NetCDF and there are many other available file formats|
| **query_start**   | ?        | Details of the query follow the ?  
| **variable_name**   | cdr_seaice_conc_monthly        | Variables from the dataset 
| **date_range**   | __[(2021-01-01T00:00:00Z):1:(2021-12-01T00:00:00Z)]__      |  Temporal range
| **spatial_range**   | [(4843696.04):1:(-4858210.64)][(-3850000.0):1:(3750000.0)]  |  Spatial range 


```{r download_sic}

# Set data request URL for PolarWatch ERDDAP data server
data_url <- "https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nhmday.nc?cdr_seaice_conc_monthly[(2021-01-01T00:00:00Z):1:(2021-12-01T00:00:00Z)][(4843696.04):1:(-4858210.64)][(-3850000.0):1:(3750000.0)]"

# Send data request and download file to the file name
f <- 'sic.nc'
download.file(data_url, destfile=f, mode="wb")
```

```{r results="hide"}

# Open netcdf file
nc=nc_open('sic.nc')

# Examine data metadata
print(nc)

# Examine names of variables
names(nc$var)

# Get first variable metadata
var1 <- nc$var[[1]]

# Examine variable metadata
print(var1)

# Get variable values
sic=ncvar_get(nc,var1$name)

# Examine dimension of variable values
dim(sic)

# Based on metadata, set xgrid, ygrid, time
xgrid <- var1$dim[[1]]$vals
ygrid <- var1$dim[[2]]$vals

# convert time variable to date format
dates=as.POSIXlt(var1$dim[[3]]$vals,origin='1970-01-01',tz='GMT')

# Close and remove the netCDF file and clear memories
nc_close(nc)
file.remove('sic.nc')

```

## Plot Sea Ice Concentration Data
```{r}
# create dataframe
sicd <- expand.grid(xgrid=xgrid, ygrid=ygrid)
sicd$sic <- array(sic, dim(xgrid)*dim(ygrid))

# exclude fillvalue
sicd$sic[sicd$sic > 2] <- NA 
# map sea ice concentration
ggplot(data = sicd, aes(x = xgrid, y = ygrid, fill=sic) ) + 
       geom_tile() + 
       coord_fixed(ratio = 1) + 
       scale_y_continuous() + 
       scale_x_continuous() +
       scale_fill_gradientn(colours=rev(brewer.pal(n = 3, name = "Blues")),na.value="tan") +
      ggtitle("Sea Ice Concentration on Polar Steregraphic projection")

```

## Get the grid cell area for each grid of the polar stereographic proection
Now we download the the cell area values (m^2) of each grid cell in the 25km resolution Northern Polar Stereographic projection.  

```{r download_cellarea}
cell_url <- "https://polarwatch.noaa.gov/erddap/griddap/pstere_gridcell_N25k.nc?cell_area%5B(5837500.0):1:(-5337500.0)%5D%5B(-3837500.0):1:(3737500.0)%5D"

f <- 'gridcell.nc'
download.file(cell_url, destfile=f, mode="wb")
```
## Examine grid cell dataset metadata and extract values

Just like the sea ice concentration dataset, we will examine the metadata and extract the variables of grid cell areas along with x and y grids.  
```{r results="hide"}
# Open netcdf file
nc1=nc_open('gridcell')

# Examine data metadata
print(nc1)

# Examine names of variables
names(nc1$var)
# cell_area[x,y]
# y 448 (actual_range: -5337500
#             actual_range: 5837500)
# x 304            actual_range: -3837500
#            actual_range: 3737500

# Get first variable metadata
area_var <- nc1$var[[1]]

# Examine variable metadata
print(area_var)

# Get variable values
cellarea =ncvar_get(nc1,area_var$name)

# Examine dimension of variable values
dim(cellarea)

# Based on metadata, set xgrid, ygrid, time
x_area <- area_var$dim[[1]]$vals
y_area <- area_var$dim[[2]]$vals

# convert time variable to date format
dates=as.POSIXlt(var1$dim[[3]]$vals,origin='1970-01-01',tz='GMT')

# Close and remove the netCDF file and clear memories
nc_close(nc1)
file.remove('gridcell.nc')
```




## Match cell area grids with sic grids

```{r}
x_indices <- which(xgrid %in% x_area)
y_indices <- which(ygrid %in% y_area)

sic.match <- sic[x_indices, y_indices,]
grid.match <- cellarea[x_indices, y_indices]

```

## Clean sea ice concentration data for sea ice area calculation
We need to clean the data before computing the sea ice area and extent.  

1.  The dataset includes flag values indicating non sea ice area such as land, lake, etc.
    * task: remove flag values (2 and higher) by setting the flag values as Nan.
2.  For this example of the sea ice area and extent calculations, 0.15 of sea ice concentration value will be used as a threshold.  
    * task: set sic value to 0 if the value is less than 0.15

For more detailed information about the flag values, go to the user guide.
For the calculation of sea ice area and extent with a threshold, go to the NSIDC article.

```{r}
# Set 0 to sic values greater than 1 (removal of flag values)
sic.match[sic.match > 1] <- 0

# Set 0 to sic values less than 0.15 (applying 0.15 threshold)
sic.match[sic.match < 0.15] <- 0

# Set NA to 0
sic.match[is.na(sic.match)] <- 0

# Sic for extent calc
sic_ext <- sic.match
sic_ext[sic_ext >= 0.15] <- 1

# Perform element-wise multiplication for time step :1 
area_total <- sic.match[,,1] * grid.match
ext_total <- sic_ext[,,1] * grid.match

# Sum sea ice grid area for time step: 1
area <- sum(area_total, na.rm = TRUE) / 1000000
extent <- sum(ext_total, na.rm = TRUE) / 1000000
print(paste("Sea Ice Area (km^2): ", area))
print(paste("Sea Ice Extent (km^2): ", extent))

```


## Create a time series with 12 months of data

```{r}

# Replicate grid areas for all timestep
rep_grid_areas <- array(rep(grid.match, each=dim(sic.match)[3]), dim=dim(sic.match))

# Perform element-wise multiplication
area_total12 <- sic.match * rep_grid_areas
ext_total12 <- sic_ext * rep_grid_areas

area12 <- apply(area_total12, c(3), sum)
ext12 <- apply(ext_total12, c(3), sum)

```


## Plot 12 time step 
```{r}

upper = max(max(ext12), max(area12))
lower = min(min(ext12), min(area12))
plot(dates,ext12,type='o',pch=20,xlab='',ylab='Sea ice area (km^2)', col="blue" ,  ylim=c(lower, upper))
lines(dates, area12, type='o', pch=20, col="red")
legend("topright", legend=c("Sea ice Area", "Sea ice Extent"),
       col=c("red", "blue"), lty=1:1, cex=0.8)
box()

```
